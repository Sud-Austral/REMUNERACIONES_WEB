<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tendencias salariales por contrato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
        }
        .chart-container {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .tab-button:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: width 0.3s ease;
        }
        .tab-button:hover:before {
            width: 100%;
        }
        .kpi-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .download-btn {
            transition: all 0.2s ease;
        }
        .download-btn:hover {
            transform: scale(1.1);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="app" class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Tendencias Salariales por Contrato</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">Análisis de remuneraciones, dotación y participación femenina en el sector público (marzo 2022–2025)</p>
        </header>

        <!-- KPI Cards -->
        <div id="kpi-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- KPIs will be dynamically inserted here -->
        </div>

        <!-- Tabs -->
        <div class="flex flex-wrap justify-center gap-3 mb-8">
            <div id="tab-buttons" class="inline-flex p-1 bg-gray-100 rounded-xl">
                <!-- Tab buttons will be dynamically inserted here -->
            </div>
        </div>

        <!-- Chart Container -->
        <div id="chart-container" class="space-y-8 mb-12">
            <!-- Charts will be dynamically inserted here -->
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm py-6 border-t border-gray-200">
            <p>Fuente: Datos internos del sector público. Actualizado: <span id="last-update"></span></p>
            <p class="mt-2">Desarrollado por el Departamento de Análisis de Recursos Humanos</p>
        </footer>
    </div>

    <script>
        // Datos y definiciones
        const tipos = ['Contrata', 'Planta', 'Honorarios', 'Cod Trabajo'];
        const base = [
            { tipo: 'Contrata', anio: 2022, hh: 103911, mm: 185756, mediaHH: 1899664, mediaMM: 1523482 },
            { tipo: 'Contrata', anio: 2023, hh: 110063, mm: 197863, mediaHH: 2083032, mediaMM: 1681734 },
            { tipo: 'Contrata', anio: 2024, hh: 122996, mm: 221150, mediaHH: 2150040, mediaMM: 1704080 },
            { tipo: 'Contrata', anio: 2025, hh: 131205, mm: 243322, mediaHH: 2405409, mediaMM: 1905822 },
            { tipo: 'Planta', anio: 2022, hh: 63353, mm: 122355, mediaHH: 2048569, mediaMM: 1710828 },
            { tipo: 'Planta', anio: 2023, hh: 66535, mm: 132501, mediaHH: 2284738, mediaMM: 1940993 },
            { tipo: 'Planta', anio: 2024, hh: 71157, mm: 142256, mediaHH: 2430967, mediaMM: 2085024 },
            { tipo: 'Planta', anio: '2025', hh: 71153, mm: 142650, mediaHH: 2577913, mediaMM: 2198437 },
            { tipo: 'Honorarios', anio: 2022, hh: 45861, mm: 65871, mediaHH: 1445670, mediaMM: 1227958 },
            { tipo: 'Honorarios', anio: 2023, hh: 45968, mm: 62627, mediaHH: 1447245, mediaMM: 946982 },
            { tipo: 'Honorarios', anio: 2024, hh: 52649, mm: 71405, mediaHH: 1330993, mediaMM: 1050797 },
            { tipo: 'Honorarios', anio: 2025, hh: 47129, mm: 58181, mediaHH: 1305797, mediaMM: 1063686 },
            { tipo: 'Cod Trabajo', anio: 2022, hh: 37187, mm: 101121, mediaHH: 1069926, mediaMM: 869193 },
            { tipo: 'Cod Trabajo', anio: 2023, hh: 42884, mm: 110608, mediaHH: 1205318, mediaMM: 979579 },
            { tipo: 'Cod Trabajo', anio: 2024, hh: 47062, mm: 115935, mediaHH: 1292399, mediaMM: 1053792 },
            { tipo: 'Cod Trabajo', anio: 2025, hh: 45732, mm: 115203, mediaHH: 1457298, mediaMM: 1177047 },
        ];
        
        // Formateadores
        const currency = v => new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 }).format(v);
        const pct = v => (v * 100).toFixed(1) + '%';
        
        // Estado de la aplicación
        let currentTab = 'Total';
        let chartInstances = {};
        
        // Cálculos de datos
        const calculateData = () => {
            const byYear = {};
            base.forEach(r => {
                if (!byYear[r.anio]) byYear[r.anio] = { anio: r.anio, hh: 0, mm: 0, sumaHH: 0, sumaMM: 0 };
                byYear[r.anio].hh += r.hh;
                byYear[r.anio].mm += r.mm;
                byYear[r.anio].sumaHH += r.hh * r.mediaHH;
                byYear[r.anio].sumaMM += r.mm * r.mediaMM;
            });
            const totalPorAnio = Object.values(byYear).sort((a, b) => a.anio - b.anio).map(y => ({
                ...y,
                mediaHH: y.sumaHH / y.hh,
                mediaMM: y.sumaMM / y.mm,
                relacion: (y.sumaHH / y.hh) / (y.sumaMM / y.mm),
                masaHH: y.sumaHH,
                masaMM: y.sumaMM,
                partFem: y.mm / (y.hh + y.mm),
            }));
            const seriesPorTipo = {};
            tipos.forEach(t => {
                seriesPorTipo[t] = base
                    .filter(r => r.tipo === t)
                    .sort((a, b) => a.anio - b.anio)
                    .map(r => ({
                        ...r,
                        relacion: r.mediaHH / r.mediaMM,
                        masaHH: r.hh * r.mediaHH,
                        masaMM: r.mm * r.mediaMM,
                        partFem: r.mm / (r.hh + r.mm),
                    }));
            });
            return { totalPorAnio, seriesPorTipo };
        };
        const { totalPorAnio, seriesPorTipo } = calculateData();
        
        // Funciones de renderizado de gráficos
        const createChartBlock = (title, innerHtml, chartId) => {
            const block = document.createElement('div');
            block.className = "chart-container p-6 fade-in";
            block.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">${title}</h2>
                    <button class="download-btn text-gray-500 hover:text-blue-600" onclick="downloadChart('${chartId}')">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                ${innerHtml}
            `;
            return block;
        };
        
        const renderChart = (chartId, type, data, options) => {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
            }
            const ctx = document.getElementById(chartId);
            if (!ctx) return;
            chartInstances[chartId] = new Chart(ctx, { type, data, options });
        };
        
        const renderLineChart = (data, title) => {
            const block = createChartBlock(
                title + ': Remuneración media (CLP/mes/persona)',
                `<div style="width: 100%; height: 320px;"><canvas id="mediaChart"></canvas></div>`,
                'mediaChart'
            );
            document.getElementById('chart-container').appendChild(block);
            renderChart('mediaChart', 'line', {
                labels: data.map(d => d.anio),
                datasets: [
                    { 
                        label: 'Media Hombres', 
                        data: data.map(d => d.mediaHH), 
                        borderColor: '#3b82f6', 
                        borderWidth: 3, 
                        tension: 0.4, 
                        fill: false,
                        pointBackgroundColor: '#3b82f6',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    },
                    { 
                        label: 'Media Mujeres', 
                        data: data.map(d => d.mediaMM), 
                        borderColor: '#10b981', 
                        borderWidth: 3, 
                        tension: 0.4, 
                        fill: false,
                        pointBackgroundColor: '#10b981',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }
                ]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1f2937',
                        bodyColor: '#1f2937',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 12,
                        cornerRadius: 8,
                        displayColors: true,
                        callbacks: {
                            label: (context) => {
                                const value = context.parsed.y;
                                return `${context.dataset.label}: ${currency(value)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        ticks: {
                            callback: (value) => value / 1e6 + 'M',
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                }
            });
        };
        
        const renderRelacionChart = (data, title) => {
            const block = createChartBlock(
                title + ': Relación salarial Hombres/Mujeres',
                `<div style="width: 100%; height: 280px;"><canvas id="relacionChart"></canvas></div>`,
                'relacionChart'
            );
            document.getElementById('chart-container').appendChild(block);
            renderChart('relacionChart', 'line', {
                labels: data.map(d => d.anio),
                datasets: [
                    { 
                        label: 'Relación HH/MM', 
                        data: data.map(d => d.relacion), 
                        borderColor: '#ef4444', 
                        borderWidth: 3, 
                        tension: 0.4, 
                        fill: false,
                        pointBackgroundColor: '#ef4444',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }
                ]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1f2937',
                        bodyColor: '#1f2937',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (context) => {
                                const value = context.parsed.y;
                                return `Relación HH/MM: ${value.toFixed(2)}x`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        min: 1,
                        ticks: {
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                }
            });
        };
        
        const renderBarChart = (data, title) => {
            const block = createChartBlock(
                title + ': Dotación por sexo',
                `<div style="width: 100%; height: 280px;"><canvas id="dotacionChart"></canvas></div>`,
                'dotacionChart'
            );
            document.getElementById('chart-container').appendChild(block);
            renderChart('dotacionChart', 'bar', {
                labels: data.map(d => d.anio),
                datasets: [
                    { 
                        label: 'Hombres', 
                        data: data.map(d => d.hh), 
                        backgroundColor: '#60a5fa',
                        borderRadius: 6,
                        barThickness: 20
                    },
                    { 
                        label: 'Mujeres', 
                        data: data.map(d => d.mm), 
                        backgroundColor: '#86efac',
                        borderRadius: 6,
                        barThickness: 20
                    }
                ]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1f2937',
                        bodyColor: '#1f2937',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                scales: {
                    x: { 
                        stacked: false, 
                        grid: { display: false },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: { 
                        stacked: false,
                        ticks: {
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                }
            });
        };
        
        const renderAreaChart = (data, title) => {
            const block = createChartBlock(
                title + ': Masa salarial mensual total (Hombres y Mujeres)',
                `<div style="width: 100%; height: 320px;"><canvas id="masaChart"></canvas></div>
                 <p class="text-xs text-gray-500 mt-2">Nota: Masa = dotación × remuneración media. Se expresa en CLP/mes; el eje Y muestra trillones (1T = 10^12 CLP).</p>`,
                'masaChart'
            );
            document.getElementById('chart-container').appendChild(block);
            renderChart('masaChart', 'line', {
                labels: data.map(d => d.anio),
                datasets: [
                    { 
                        label: 'Masa Hombres', 
                        data: data.map(d => d.masaHH), 
                        borderColor: '#3b82f6', 
                        backgroundColor: 'rgba(59, 130, 246, 0.2)', 
                        borderWidth: 3, 
                        fill: true, 
                        tension: 0.4,
                        pointBackgroundColor: '#3b82f6',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    },
                    { 
                        label: 'Masa Mujeres', 
                        data: data.map(d => d.masaMM), 
                        borderColor: '#10b981', 
                        backgroundColor: 'rgba(16, 185, 129, 0.2)', 
                        borderWidth: 3, 
                        fill: true, 
                        tension: 0.4,
                        pointBackgroundColor: '#10b981',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }
                ]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1f2937',
                        bodyColor: '#1f2937',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 12,
                        cornerRadius: 8,
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: (context) => {
                                const value = context.parsed.y;
                                return `${context.dataset.label}: ${currency(value)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        ticks: {
                            callback: (value) => (value / 1e12).toFixed(1) + 'T',
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                }
            });
        };
        
        const renderPartFemChart = (data, title) => {
            const block = createChartBlock(
                title + ': Participación femenina en dotación',
                `<div style="width: 100%; height: 260px;"><canvas id="partFemChart"></canvas></div>`,
                'partFemChart'
            );
            document.getElementById('chart-container').appendChild(block);
            renderChart('partFemChart', 'line', {
                labels: data.map(d => d.anio),
                datasets: [
                    { 
                        label: '% Mujeres', 
                        data: data.map(d => d.partFem), 
                        borderColor: '#8b5cf6', 
                        borderWidth: 3, 
                        tension: 0.4, 
                        fill: false,
                        pointBackgroundColor: '#8b5cf6',
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }
                ]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1f2937',
                        bodyColor: '#1f2937',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (context) => {
                                const value = context.parsed.y;
                                return `Participación femenina: ${pct(value)}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        min: 0,
                        max: 1,
                        ticks: {
                            callback: (value) => (value * 100).toFixed(0) + '%',
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                }
            });
        };
        
        const renderAllCharts = (data, title, mostrarDotacion = true) => {
            const container = document.getElementById('chart-container');
            container.innerHTML = '';
            
            renderLineChart(data, title);
            renderRelacionChart(data, title);
            if (mostrarDotacion) {
                renderBarChart(data, title);
            }
            renderAreaChart(data, title);
            renderPartFemChart(data, title);
        };
        
        // Función para descargar gráficos
        const downloadChart = (chartId) => {
            if (chartInstances[chartId]) {
                const link = document.createElement('a');
                link.download = `${chartId}_${new Date().toISOString().slice(0, 10)}.png`;
                link.href = chartInstances[chartId].toBase64Image();
                link.click();
            }
        };
        
        // Función para renderizar KPIs
        const renderKPIs = () => {
            const container = document.getElementById('kpi-container');
            container.innerHTML = '';
            
            // Calcular KPIs generales
            const latestYear = Math.max(...base.map(item => parseInt(item.anio)));
            const latestData = base.filter(item => parseInt(item.anio) === latestYear);
            
            let totalHH = 0, totalMM = 0, totalMasaHH = 0, totalMasaMM = 0;
            
            latestData.forEach(item => {
                totalHH += item.hh;
                totalMM += item.mm;
                totalMasaHH += item.hh * item.mediaHH;
                totalMasaMM += item.mm * item.mediaMM;
            });
            
            const totalDotacion = totalHH + totalMM;
            const totalMasa = totalMasaHH + totalMasaMM;
            const mediaTotal = totalMasa / totalDotacion;
            const partFem = totalMM / totalDotacion;
            
            // Crear tarjetas KPI
            const kpis = [
                {
                    title: "Dotación Total",
                    value: totalDotacion.toLocaleString('es-CL'),
                    icon: "fa-users",
                    color: "bg-blue-100 text-blue-600"
                },
                {
                    title: "Masa Salarial",
                    value: currency(totalMasa),
                    icon: "fa-money-bill-wave",
                    color: "bg-green-100 text-green-600"
                },
                {
                    title: "Remuneración Media",
                    value: currency(mediaTotal),
                    icon: "fa-chart-line",
                    color: "bg-purple-100 text-purple-600"
                },
                {
                    title: "Participación Femenina",
                    value: pct(partFem),
                    icon: "fa-venus",
                    color: "bg-pink-100 text-pink-600"
                }
            ];
            
            kpis.forEach(kpi => {
                const card = document.createElement('div');
                card.className = "kpi-card p-6 fade-in";
                card.innerHTML = `
                    <div class="flex items-center">
                        <div class="${kpi.color} p-3 rounded-lg mr-4">
                            <i class="fas ${kpi.icon} text-xl"></i>
                        </div>
                        <div>
                            <p class="text-gray-500 text-sm">${kpi.title}</p>
                            <p class="text-2xl font-bold text-gray-800">${kpi.value}</p>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        };
        
        // Función principal de renderizado
        const renderApp = () => {
            const tabButtonsContainer = document.getElementById('tab-buttons');
            tabButtonsContainer.innerHTML = '';
            ['Total', ...tipos].forEach(t => {
                const button = document.createElement('button');
                button.textContent = t;
                button.className = (t === currentTab ? 
                    'bg-blue-600 text-white shadow-md ' : 
                    'text-gray-700 hover:bg-gray-200 ') + 
                    'tab-button px-4 py-2 rounded-lg font-medium transition-all duration-300';
                button.addEventListener('click', () => {
                    currentTab = t;
                    renderApp();
                });
                tabButtonsContainer.appendChild(button);
            });
            
            const dataToDisplay = currentTab === 'Total' ? totalPorAnio : seriesPorTipo[currentTab];
            const title = currentTab === 'Total' ? 'Total sector público' : currentTab;
            renderAllCharts(dataToDisplay, title, currentTab === 'Total');
            
            // Actualizar fecha de última actualización
            document.getElementById('last-update').textContent = new Date().toLocaleDateString('es-CL', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };
        
        // Iniciar la aplicación
        window.onload = () => {
            renderKPIs();
            renderApp();
        };
    </script>
</body>
</html>